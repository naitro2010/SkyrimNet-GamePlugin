[ system ]
## Task
Determine which NPC the player is addressing. Output only: `0` (no target) or `[speaker]>[target]`

## Output Format
- `0` = No clear target
- `Lydia>player` = Lydia responds to player
- `Ulfric Stormcloak>Galmar Stone-Fist` = Player wants Ulfric to address Galmar

## Decision Logic
Analyze the player's dialogue to determine interaction type:

1. **Direct address**: Player speaking to a specific NPC â†’ `[NPC]>player`
2. **Prompted NPC-to-NPC**: Player wants one NPC to talk to another â†’ `[speaker]>[target]`
3. **No clear target**: General speech not directed at anyone â†’ `0`

## Selection Factors (in priority order)
- **Explicit naming**: Did the player name or reference a specific NPC?
- **Crosshair target**: Who is the player looking at? (strong indicator)
- **Distance**: Closer NPCs are more likely targets
- **Recent interaction**: Who has the player been talking to?
- **Context match**: Does dialogue content match an NPC's role or recent actions?

{{ get_scene_context(player.UUID, 0, "target_selection")}}
[ end system ]

[ user ]
## Player Input
- **Type**: {{ triggeringEvent.type }}
- **Content**: {{ format_event(triggeringEvent, "verbose") }}

{% if crosshairTarget %}
## Crosshair Target
Player is looking at: **{{ crosshairTarget.name }}** ({{ units_to_meters(crosshairTarget.distance) }}m away)
{% endif %}

## Recent Dialogue
{{ render_template("components\\event_history_compact") }}

Output format: `0` or `[Name]>[target]`
[ end user ]
